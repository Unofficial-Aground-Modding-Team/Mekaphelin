<data>
  <include id="vehicleLoading.xml"/>
  <!-- Local Version 1.0 -->
  <tilesheet id="uefd_carrier.png" width="832" height="256"/>
  <tile id="uefd_carrier" sheet="uefd_carrier.png"/>
  <vehicle id="uefd_carrier" extends="colony_ship" tile="uefd_carrier" canLoadVehicles="true" spaceship="true">
    <interior area="uefd_carrier.interior" offsetX="0" offsetY="-464" enterX="10" enterY="-1" exitX="7" operateX="6" operateY="-24" />
    <tooltip section="structure.tooltip" id="spaceship" if="player.vehicle.getId() == 'corvette'" />
    <operate><action with="ellipse_fast">if(player.vehicle == null) this.enter(player); else loadCorvette(player);</action><stop/></operate>
  </vehicle>

  <structure id="uefd_carrier.bg" tile="uefd_carrier" priority="-2" back="true" remove="false" />
  <area id="uefd_carrier.interior">
    <structure id="uefd_carrier.bg" x="0" y="0" />
    <object id="ship.exit3" x="15" y="-10" />
    <structure id="corvette_bay" x="9" y="0"/>
    <structure id="corvette_bay" x="18" y="0"/>
    <structure id="corvette_bay" x="27" y="0"/>
    <structure id="corvette_bay" x="36" y="0"/>

    <tiles from="uefd_carrier_tiles.png" x="0" y="-16"><tile id="empty" color="000000" /><tile id="empty" layer="back" color="ffffff" /><tile id="no_place" color="ff0000" layer="back" /></tiles>
    <init><runAreaLoad /></init>
  </area>

  <area id="corvette.interior" name="fighter" shouldLight="false" powered="getPowerCores(this) > 0">
		<structure id="fighter.command" x="2" y="2" />
		<structure id="fighter.weaps" x="2" y="3" />
		<structure id="fighter.cargo" x="1" y="4" />
		<structure id="fighter.engine" x="5" y="4" />

    <structure id="axolotl.exit" x="5" y="5" />

		<object id="power_core.slot" x="6" y="2" />
		<object id="power_core.slot" x="6" y="3" />
		<object id="power_core.slot" x="6" y="4" />

    <object id="ship.doorh" x="4.5" y="2" />
    <object id="ship.doorh" x="4.5" y="3" />
    <object id="ship.doorh" x="4.5" y="4" />
    <object id="ship.doorv" x="5" y="4.5" />


		<action>for(y in 0...10) for(x in 0...14) setBack(x, y, "empty"); cleanShipInterior(area, 14, 10);</action>

		<init><music id="technically" seconds="1" /></init>
		<onLoad>
			<action if="area.getTileString(0,0,BACK_LAYER) == 'empty'">cleanShipInterior(area, 14, 10);</action>
			<set id="this" value="area.getObject('fighter.exit')" />
			<run procedure="fighter.exit.close" if="area.getTileString(this.tile_x-3, this.tile_y, BASE_LAYER) == 'empty'" />
			<music id="technically" seconds="1" />
		</onLoad>
	</area>

  <tilesheet id="corvette.png" width="128" height="64"/>
  <tile id="corvette" sheet="corvette.png" x="0"/>
  <animation id="corvette.fly" x="0" count="3"/>
  <animation id="corvette.hover" x="3" count="3"/>
  <animation id="corvette.idle" x="3" count="3"/>
  <vehicle id="corvette" tile="corvette" health="750" fuel="1000" useBatteries="false" efficiency="0" fuelName="power" defense="6" speed="14" speedY="7" attack_move="true" type="spaceship" blood="science.explosion.med" title="world.fighter" underground="false" flight_height="999" max_weight="3000" death_sfx="explosion" block_icon="fighter.shields.ico" block_behind="true" block_move="true" icon="escort_fighter.ico" takeoff_sfx="ship_takeoff" land_sfx="ship_land" loadInto="corvette_bay" accessObject="true">
    <interior area="corvette.interior" offsetX="17" offsetY="20" enterX="6" enterY="5" exitX="5.5" operateX="3" operateY="2" />
    <repair id="titanium" value="250" />
    <listItem title="vehicle.load_corvette" enabled="this.area.vehicle == null">
      <action>loadCorvette(player);</action>
    </listItem>
    <listItem title="vehicle.unload_corvette" enabled="this.area.vehicle != null">
      <action>unloadCorvette(player);</action>
    </listItem>
    <!-- <operateHitbox x="118" y="81" width="47" height="35" /> -->
    <dismount><action>setGameScale(1); if(this.renderer != null) this.renderer.scaleX = 1;</action></dismount>
    <light tile="light.fighter" /><slot id="attack" />
    <onDeath><run procedure="launch.lifepod" /></onDeath>
    <init><set id="partial" value="0" /><set id="cores" value="0" /></init>
    <onFrame>
      var f2 = frames*2; var of = Math.floor(f2); partial += f2-of; if(partial >= 1){of++; partial -= 1;}
      var p = of*cores; if(this.blocking) p -= of*4; if(p > 0) this.addFuel(p); else if(p &lt; 0) this.useFuel(-p);
    </onFrame>
    <!-- <mount><set id="cores" value="getPowerCores(this.interior)" /></mount> -->
    <exitInterior><run object="fighter" event="mount" /></exitInterior>
    <shield tile="fighter.shields" animation="fighter.shields" hit_front="fighter.shields.front" hit_back="fighter.shields.back" hit_sfx="ship_shield" />
  </vehicle>

  <structure id="corvette_bay" width="160" height="98" image="corvette_bay.png" priority="-1" remove="false" layer="npc">
    <!-- <tile id="station.dock" name="back" animation="hidden" fps="9" y="0" behind="true" /> -->
    <!-- <tile id="station.dock" name="top" animation="station.dock.idle.top" fps="9" x="0" y="0" /> -->
    <rideableExit>
      <section if="rideable.info.xml.get('type') == 'spaceship'">
        <action>player.doTeleport(null, (this.tile_x+11)*Tile.SIZE, (this.tile_y-Math.round(this.info.height/Tile.SIZE)+7)*Tile.SIZE, false, false, this.area);</action><stop />
      </section>
    </rideableExit>
  </structure>

  <lang id="en_US">
    <section id="vehicle">
      <text id="load_corvette">Load</text>
      <text id="unload_corvette">Unload</text>
    </section>
  </lang>
</data>
