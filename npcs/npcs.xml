<?xml version="1.0" encoding="UTF-8"?>
<data>
  <npc id="uefd_engineer" tile="mechanic" action="talk" talk_sfx="talking6" animation="mechanic">
    <idle class="repair"><repair type="uefd_engineer"/><repair type="mechanic"/></idle>
  </npc>
  <!-- <npc id="uefd_leader" tile="builder" action="talk" talk_sfx="talking1">
    <operate>

    </operate>
  </npc> -->

  <tile id="uefd_drone1" sheet="uefd_drone1.png" x="0"/>
  <animation id="uefd_drone1.walk" x="0" count="4"/>
  <animation id="uefd_drone1.idle" x="4" count="4"/>
  <npc id="uefd_drone1" tile="uefd_drone1" speed="2" night="true" behind="true" title="item.names.worker_bot"><idle class="wander" fromX="25" toX="75"/></npc>

  <tilesheet id="uefd_drone2.png" width="20" height="26"/>
  <tile id="uefd_drone2" sheet="uefd_drone2.png" x="0"/>
  <animation id="uefd_drone2.idle" x="0" count="4"/>
  <animation id="uefd_drone2.walk" x="4" count="4"/>
  <npc id="uefd_drone2" tile="uefd_drone2" speed="3" night="true" behind="true" title="item.names.worker_bot"><idle class="wander" fromX="25" toX="75"/></npc>

  <npc id="uefd.townfolk" extends="science1.townfolk.base">
    <idle class="wander" fromX="30" toX="70"/>
  </npc>

  <!-- Mekaphelin Signal -->
  <npc id="com_station" tile="com_device.ico"/>
  <procedure id="mekaphelin.signal">
    <section if="player.questComplete('com_station') && !player.hasQuest('repair_com_station')" >
      <call id="com_station" incoming="true"/>
      <dialogue section="mekaphelin" id="mek_signal"/>
      <call id="com_station" end="true" />
      <call id="mechanic" incoming="true"/>
      <dialogue section="mechanic" id="mek_signal1" speaker="mechanic"/>
      <dialogue section="mechanic" id="mek_signal2" speaker="mechanic"/>
      <call id="mechanic" end="true" />
      <quest id="repair_com_station" ask="false"/>
    </section>
  </procedure>

  <structure id="com_station" extends="com_station" >
    <tooltip id="summon_mechanic" if="player.canCompleteQuest('repair_com_station')"/>
    <tooltip id="operate" if="!player.hasQuest('repair_com_station') || player.questComplete('repair_com_station')"/>
    <operate>
      <section if="player.canCompleteQuest('repair_com_station')">
        <run procedure="mechanic.repair_com_station"/>
        <stop />
      </section>
    </operate>
  </structure>

  <procedure id="mechanic.repair_com_station">
    <sound id="build" /><complete quest="repair_com_station" />
    <section with="fade">
      <teleport area="science2" x="58" y="-33" />
      <object id="fake_jet" x="52" y="-33" /><action>fake_jet.moveToFront()</action><facing object="player" dir="left" />
      <object id="mechanic" name="mechanic_object" x="54" y="-33" facing="right" />
    </section>
    <dialogue section="mechanic" id="mek_signal3" speaker='mechanic_object' />
    <quest id="mekaphelin_signal"/>
    <lerp object="mechanic_object" alpha="0" seconds="0.25" /><remove object="mechanic_object" />
    <play object="fake_jet" animation="jet.mount" modal="true" />
    <play object="fake_jet" animation="jet.takeoff" modal="true" /><play object="fake_jet" animation="jet.hover" loop="true" />
    <lerp object="fake_jet" deltaY="-7" seconds="2" modal="true" /><remove object="fake_jet" />
  </procedure>

  <quest id="repair_com_station" giver="mechanic" exp="100">
    <item id="titanium" count="2"/>
    <location id="science2" x="32" y="-33" width="32" height="1" name="quests.highest_mountain" />
  </quest>
  <quest id="mekaphelin_signal" giver="mechanic" exp="500" >
    <flag id="mekaphelin_signal" name="quest.mekaphelin_signal_find" hidden="true"/>
  </quest>
</data>
